!function(){var e=Lizard.webresourceBaseUrl;require.config({paths:{journeyCommon:e+"js/Journey/Common/common",gsCommonGeolocation:e+"js/Common/CommonGeolocation",googleMaper:e+"js/Journey/Common/google_maper",gsJourneySearchListModel:e+"js/Journey/Models/SearchListModel",gsJourneyMapHotelModel:e+"js/Journey/Models/MapHotelModel",gsJourneyMapRestaurantModel:e+"js/Journey/Models/MapRestaurantModel",gsBaseView:e+"js/Journey/Common/BaseView",JMaper:e+"js/Journey/Common/journey_maper",gsJourneyScheduleStore:e+"js/Journey/JourneyStore",gsJourneyListModel:e+"js/Journey/Models/ListModel",gsJourneyDetailModel:e+"js/Journey/Models/DetailModel"}})}(),define("js/Journey/require_config",function(){}),define("journeyCommon",["gsRouterRedirect","gsCommonGeolocation","gsAppAgent","cUtilCryptBase64"],function(e,t,i,n){return{getJourneyUrl:function(e,t,i,n,o){var r="",a="",s=this.webBaseUrl,l="destination/journey/index.html#journeys/";return t=t||"","list"==e?r=t+i:"detail"==e?r=t+i+"/"+n:"packagemap"==e?r=e+"/"+n:"travelscheme"==e||"travelschememap"==e?(r=e+"/"+n,l="destination/journey/index.html#"):r=t+i+"/"+n+"-"+e,r+=".html",a=l+r+"?hideBrandTip=1",r=s+r+"?hideBrandTip=1",o&&(r+="?hideBrandTip=1&journeyPage="+o),[r,a]},getParam:function(e){var t=Lizard.P(e);return"districtId"==e&&t.match(/\D/)&&(t=t.match(/(.*[a-z])(\d+)/i)[2]),t},getDistrictEname:function(){var e=Lizard.P("districtId");return e=e.match(/\D/)?e.match(/(.*[a-z])(\d+)/i)[1]:""},back:function(){if(Lizard.isHybrid)e.toBack();else{if(document.referrer.indexOf("/webapp/you/")>0)e.toBack();else{var t=Lizard.P("journeyPage")||"";if(t){var i=this.getDistrictEname(),n=this.getParam("districtId"),o=this.getParam("journeyId"),r=this.getJourneyUrl(t,i,n,o);e.toJump({url:r})}else e.toBack()}}},getCurrentCityId:function(e){if(i.isGsHybrid())e(2);else{var t=localStorage.getItem("JOURNERY_CURRENT_DISTRICT"),n=!0,o=1;if((t=JSON.parse(t))&&t.cityId){n=!1,o=t.cityId;var r=t.timeout;(new Date).getTime()>r&&(n=!0)}n?this.getGeolocation(function(t){o=t.districtId||1;var i=(new Date).getTime()+72e5,n={cityId:o,timeout:i};localStorage.setItem("JOURNERY_CURRENT_DISTRICT",JSON.stringify(n)),e(o)},function(){var t=(new Date).getTime()+72e5,i={cityId:2,timeout:t};localStorage.setItem("JOURNERY_CURRENT_DISTRICT",JSON.stringify(i)),e(2)}):e(o)}},getGeolocation:function(e,i){t.getLocationInfo({onComplete:function(t){e&&"function"==typeof e&&e(t)},onCommonError:function(){i&&"function"==typeof i&&i()}})},showTip:function(e,t){Lizard.showToast(e)},buildAppUrl:function(e){var t=window.location.origin,i="";return t||(t=window.location.protocol+"//"+window.location.host),i=t+window.location.pathname,e&&(i+="#"),i+e},jointUrl:function(e){if(null!=e&&""!=e)return 0==e.indexOf("/")&&(e=e.substr(1)),0==e.indexOf("webapp/")&&(e="/"+e),Lizard.isHybrid||(e=this.addFromUrl(e)),e},addFromUrl:function(e){var t=window.location.href;return e.lastIndexOf("from=")==e.length-5?e+=encodeURIComponent(t):e.lastIndexOf("?")==e.length-1||e.lastIndexOf("&")==e.length-1?e+="from="+encodeURIComponent(t):e.indexOf("?")>-1?e+="&from="+encodeURIComponent(t):e+="?from="+encodeURIComponent(t),e},goToPoiDetail:function(t,o,r,a,s,l,d){a=a||"",l=l||"";var c="",u="",h=4,f=window.location.origin,p=f+"/webapp",m="?from="+encodeURIComponent(window.location.href);switch(t){case"11":case"sight":c=p+"/you/sight/"+l+o+"/"+r+".html"+m+"&hideBrandTip=1",u="ctrip://wireless/h5?type=5&url="+n.Base64.encode("/rn_destination_poi/main.js?CRNModuleName=rn_destination_poi&CRNType=1&initialPage=sightDetail&businessId="+r),h=1;break;case"12":case"restaurant":c=p+"/you/foods/"+l+o+"/"+r+".html"+m+"&hideBrandTip=1",u="food/index.html#foods/"+l+o+"/"+r+".html?hideBrandTip=1";break;case"13":case"shopping":c="/webapp/you/shops/"+l+o+"/"+r+".html",u=c,c+=m,h=2;break;case"14":h=1,s=s||"",c=2==s?p+"/hotel/oversea/hoteldetail/"+r+"/checkin-1-5.html"+m:p+"/hotel/hoteldetail/"+r+"/checkin-1-5.html"+m;var g=new Date,y=new Date(g.getTime()+432e6),v=y.getMonth()+1;v<10&&(v="0"+v);var I=y.getDate();I=I<10?"0"+I:I;var w=y.getFullYear()+""+v+I;y=new Date(g.getTime()+5184e5),v=y.getMonth()+1,v<10&&(v="0"+v);var _=y.getDate();_=_<10?"0"+_:_;u="/InlandHotel?hotelDataType="+s+"&checkInDate="+w+"&checkOutDate="+(y.getFullYear()+""+v+_)+"&hotelId="+r;break;case"18":c=p+"/you/resort/"+l+o+"/"+r+".html"+m+"&hideBrandTip=1",u="destination/ttd/index.html#resort/"+l+o+"/"+r+".html?hideBrandTip=1";break;case"26":if(i.isGsHybrid())return;c=(Lizard.H5BaseUrl||"//m.ctrip.com")+"/webapp/you/flight/detail-"+r+".html"+m,u="/destination/toResInfo?name="+a+"&type=12&id="+r,h=1;break;case"27":if(i.isGsHybrid())return;c=(Lizard.H5BaseUrl||"//m.ctrip.com")+"/webapp/you/train/detail-"+r+".html"+m,u="/destination/toResInfo?name="+a+"&type=14&id="+r,h=1;break;case"28":if(i.isGsHybrid())return;c=(Lizard.H5BaseUrl||"//m.ctrip.com")+"/webapp/you/harbour/detail-"+r+".html"+m,u=(Lizard.H5BaseUrl||"//m.ctrip.com")+"/webapp/you/harbour/detail-"+r+".html"+m,h=2;break;case"34":if(i.isGsHybrid())return;c=(Lizard.H5BaseUrl||"//m.ctrip.com")+"/webapp/you/bus/detail-"+r+".html"+m,u=(Lizard.H5BaseUrl||"//m.ctrip.com")+"/webapp/you/bus/detail-"+r+".html"+m,h=2;break;default:h=1,c=p+"/you/place/"+l+o+".html"+m+"&hideBrandTip=1",u="/destination/toDestMain?districtId="+r+"&hideBrandTip=1&districtName="+d}"13"==t?e.toJump({host:Lizard.H5BaseUrl,url:[c],targetModel:2}):e.toJump({url:[c,u],targetModel:h})},getApi:function(e){return Lizard.restfullApiHttps+"10120/json/"+e+"?format=json"},webBaseUrl:window.location.origin+"/webapp/you/journeys/"}}),define("googleMaper",[],function(){return function(e){var t,i=this,n=null,o={},r={},a=null,s=null;i.init=function(e){var t=document.getElementById(e.mapInner),i={center:new google.maps.LatLng(e.lat,e.lng),zoom:15,zoomControl:!1,mapTypeControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",stylers:[{saturation:-28}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{saturation:50}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#cccccc"},{saturation:-25}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]}]};n=new google.maps.Map(t,i)},i.setZoomRange=function(){google.maps.event.addListener(n,"zoom_changed",function(){var e=n.getZoom();e<3&&n.setZoom(3),e>25&&n.setZoom(25)})},i.setCenter=function(e){n.setCenter(e)},i.setCenterByLatLng=function(e,t){n.setCenter(new google.maps.LatLng(e,t))},i.setZoom=function(e){n.setZoom(e)},i.setFitView=function(){var e=new google.maps.LatLngBounds;for(var t in o){o[t].getMap()&&e.extend(o[t].latLng)}n.fitBounds(e)},i.addMarker=function(e,t){var i=new google.maps.LatLng(e.lat,e.lng),n=e.id,r=new a(e.markerHtml,i,function(){var e=$(this.div.firstChild);t(e,i)});o[n]=r},i.getMarker=function(e){var t=o[e];if(t)return t},i.removeMarker=function(e){var t=o[e];t&&(t.setMap(null),delete o[e])},i.removeMarkers=function(e){for(var t=e.length,n=0;n<t;n++)i.removeMarker(e[n])},i.showMarker=function(e){var t=o[e];t&&t.setMap(n)},i.showMarkers=function(e){for(var t=e.length,n=0;n<t;n++)i.showMarker(e[n])},i.Polyline=function(e){var i=[],o=e.length;if(0!=e.length){for(var r=0;r<o;r++)i.push(new google.maps.LatLng(e[r].lat,e[r].lng));t&&t.setMap(null),t=new google.maps.Polyline({path:i,strokeColor:"#000000",strokeOpacity:.6,strokeWeight:3}),t.setMap(n)}},i.hideMarker=function(e){var t=o[e];t&&t.setMap(null)},i.hideMarkers=function(e){for(var t=e.length,n=0;n<t;n++)i.hideMarker(e[n])},i.checkMarker=function(e){return!!o[e]},i.checkMarkerShow=function(e){return!(!o[e]||!o[e].getMap())},i.createInfo=function(e,t){var o=e.id,a=r[o];if(a){if(a.getMap())return}else{var l=e.gOffset||[0,-100];a=new s(e.infoHtml,e.latLng,l,function(){t($(this.div.firstChild))}),r[o]=a}i.hideInfoWindows(),a.setMap(n)},i.checkInfo=function(e){return!!r[e]},i.getInfo=function(e){var t=r[e];return t||null},i.openInfo=function(e){i.hideInfoWindows(),i.getInfo(e).setMap(n)},i.hideInfoWindow=function(e){var t=r[e];t&&t.setMap(null)},i.hideInfoWindows=function(){for(var e in r)if(r.hasOwnProperty(e)){var t=r[e];t.setMap(null)}},i.clearInfoWindow=function(){for(var e in r)if(r.hasOwnProperty(e)){var t=r[e];t.setMap(null)}r={}},function(){a=function(e,t,i){this.html=e,this.latLng=t,this.ready=i,this.div=null},a.prototype=new google.maps.OverlayView,$.extend(a.prototype,{onAdd:function(){var e=document.createElement("div");e.innerHTML=this.html,e.style.position="absolute",this.getPanes().overlayImage.appendChild(e),this.div=e,this.ready.call(this)},draw:function(){this.dom=this.div.firstChild;var e=this.getProjection().fromLatLngToDivPixel(this.latLng);this.div.style.left=e.x-12+"px",this.div.style.top=e.y-25+"px"},onRemove:function(){this.div.parentNode.removeChild(this.div),this.div=null}})}(),function(){s=function(e,t,i,n){this.html=e,this.latLng=t,this.ready=n,this.div=null,this.offset=i},s.prototype=new google.maps.OverlayView,$.extend(s.prototype,{onAdd:function(){var e=document.createElement("div");e.innerHTML=this.html,e.style.position="absolute",e.style.zIndex="5",this.getPanes().overlayImage.appendChild(e),this.div=e,this.ready.call(this)},draw:function(){this.div.style.left="-100px",this.div.style.bottom="-20px",this.div.firstChild.style.visibility="hidden",this.div.firstChild.style.display="block";var e=this.getProjection(),t=n.getBounds(),i=e.fromLatLngToDivPixel(this.latLng),o=t.getNorthEast().A,r=t.getSouthWest().A,a=e.fromLatLngToDivPixel(t.getNorthEast()),s=e.fromLatLngToDivPixel(t.getSouthWest()),l=$(this.div.firstChild).width(),d=$(this.div.firstChild).height(),c=l/2;left=i.x-c+this.offset[0],bottom=-i.y+(d+this.offset[1]),this.div.style.left=left+"px",this.div.style.bottom=bottom+"px",this.div.firstChild.style.visibility="visible";var u=0,h=0;i.x<s.x+c+5&&(u=i.x-(s.x+c+5)),i.x>a.x-c-5&&(u=i.x-(a.x-c-5)),h=i.y-(d+55)-a.y,h=h<0?h:0,180!==o&&-180!==r?(u||h)&&n.panBy(u,h):h&&n.panBy(0,h)},onRemove:function(){this.div.parentNode.removeChild(this.div),this.div=null}})}()}}),define("gsJourneyListModel",["cModel","cCoreInherit"],function(e,t){function i(i,n,o){return new t.Class(e,{__propertys__:function(){this.url="/soa2/"+i,this.method="POST",this.param=n,this.dataformat=o},initialize:function($super,e){$super(e)}}).getInstance()}var n={ListModel:["16419/json/getScheduleListForH5",{districtId:0,districtIds:[],poiIds:[],days:[],minDay:0,tagIds:[],pageNo:0,pageSize:0}]};return _.each(n,function(e,t){n[t]=i.apply(this,e)}),n}),define("gsJourneySearchListModel",["cModel","cCoreInherit","journeyCommon"],function(e,t,i){var n=new t.Class(e,{__propertys__:function(){this.url=i.getApi("SearchScheduleToolFor615"),this.param={DistrictAreaId:commonUtil.getSearchDistrictIds(),ScheduleDay:Lizard.P("Days")||0,TagIds:commonUtil.getSearchTagIds(),CoverImageSize:{Width:600,Height:339},ItemFrom:1,ItemTo:15,Latitude:Lizard.P("lat"),Longtitude:Lizard.P("lon"),FilterDistrictIds:null}},initialize:function($super,e){$super(e)},setDistrictId:function(e){this.setParam({DistrictAreaId:e})},setPageIndex:function(e){this.setParam({ItemFrom:e<=1?1:15*(e-1)+1,ItemTo:15*e})},getData:function(e,t){this.excute(function(t){e&&e.call(this,t)},function(){t&&"function"==typeof t&&t()})}});return n.GetRelDistrictFor615=function(e,t,i){var o=n.District.getInstance();o.setParam(e),o.excute(function(e){e?t&&t.call(this,e):i&&i.call(this)},function(){i&&i.call(this)},!1)},n.District=new t.Class(e,{__propertys__:function(){this.url="/soa2/10130/json/GetRelDistrictFor615",this.method="POST",this.param={}},initialize:function($super,e){$super(e)},paraData:function(e){return e}}),n}),define("gsJourneyDetailModel",["cModel","cCoreInherit"],function(e,t){var i=i||{};return i.GetRecommendProducts=new t.Class(e,{__propertys__:function(){this.url=Lizard.restfullApiHttps+"16419/json/getRecommendProducts",this.method="POST",this.param={districtId:"",scheduleInfoId:""}},initialize:function($super,e){$super(e)}}),i.detailmodel=new t.Class(e,{__propertys__:function(){this.url=journeyCommon.getApi("GetH5ScheduleDetail"),this.param={ClientDistrictId:2,DistrictId:2,ScheduleInfoId:100,FrontCoverImageSize:{Width:750,Height:436},PoiCoverImageSize:{Width:640,Height:320}}},initialize:function($super,e){$super(e)}}),i.getDetailImgslider=new t.Class(e,{__propertys__:function(){this.url="/soa2/10319/AdvertBannerInfo",this.method="GET",this.param={Position:8004}},initialize:function($super,e){$super(e)}}),i.convertToTravelPlan=new t.Class(e,{__propertys__:function(){this.url="/soa2/10120/ConvertToTravelPlan",this.param={ScheduleInfoId:0,Guid:0}},initialize:function($super,e){$super(e)}}),i.getAirTicket=new t.Class(e,{__propertys__:function(){this.url="/soa2/10120/GetH5ScheduleAirTicket",this.param={ScheduleInfoId:0,UserDistrictId:0}},initialize:function($super,e){$super(e)}}),i.deletePlan=new t.Class(e,{__propertys__:function(){this.url="/soa2/16419/saveUserScheduleDetailForH5",this.param={scheduleId:0,scheduleType:1,isDelete:!0}},initialize:function($super,e){$super(e)}}),i.getPlanList=new t.Class(e,{__propertys__:function(){this.url="/soa2/16419/getUserScheduleListForH5",this.param={width:"750",height:"320",starNo:1,count:20,type:Lizard.P("fromPage")&&"crnEditPage"==Lizard.P("fromPage")?1:0}},initialize:function($super,e){$super(e)}}),i.AddVoiceFavorite=new t.Class(e,{__propertys__:function(){this.url="/soa2/11833/AddVoiceFavorite",this.method="POST",this.param={}},initialize:function($super,e){$super(e)}}),i.CancelVoiceFavorite=new t.Class(e,{__propertys__:function(){this.url="/soa2/11833/CancelVoiceFavorite",this.method="POST",this.param={}},initialize:function($super,e){$super(e)}}),i.CheckVoiceFavorite=new t.Class(e,{__propertys__:function(){this.url="/soa2/11833/CheckVoiceHadFavorite",this.method="POST",this.param={}},initialize:function($super,e){$super(e)}}),i.GetTraveListCount=new t.Class(e,{__propertys__:function(){this.url="/soa2/10120/GetTravelPlanCountByUID",this.method="POST",this.param={}},initialize:function($super,e){$super(e)}}),i.ChangeTravelPlanPlayDate=new t.Class(e,{__propertys__:function(){this.url="/soa2/10120/ChangeTravelPlanPlayDate",this.method="POST",this.param={}},initialize:function($super,e){$super(e)}}),i.GetHolidayProduct=new t.Class(e,{__propertys__:function(){this.url="/soa2/13561/json/search",this.method="POST",this.param={client:{source:"NVacationMobile",trace:"none"},filtered:{tab:"2",saleCity:2,startCity:0,channel:"H5",items:[],sort:5,pageIndex:1,pageSize:15},returnType:{type:"all",filters:"ProductLine",recommendProduct:!1,aggregateProduct:!1}}},initialize:function($super,e){$super(e)}}),i}),define("gsJourneyMapHotelModel",["cModel","cCoreInherit","journeyCommon"],function(e,t,i){return new t.Class(e,{__propertys__:function(){this.url=i.getApi("GetH5ScheduleHotelList"),this.param={ScheduleInfoId:100,DayIndex:1}},initialize:function($super,e){$super(e)},setScheduleInfoId:function(e){this.setParam({ScheduleInfoId:e})},getData:function(e,t){this.setParam({DayIndex:e}),this.excute(function(e){t&&t.call(this,e)})}})}),define("gsJourneyScheduleStore",["cStore","cCoreInherit"],function(e,t){var i=i||{};return i.RandomNum=new t.Class(e,{__propertys__:function(){this.key="GS_JOURNEY_RANDOMNUM",this.lifeTime="1D"},initialize:function($super,e){$super(e)}}),i.GuideStore=new t.Class(e,{__propertys__:function(){this.key="GS_JOURNEY_GUIDE",this.lifeTime="365D"},initialize:function($super,e){$super(e)}}),i}),define("gsJourneyMapRestaurantModel",["cModel","cCoreInherit","journeyCommon"],function(e,t,i){return new t.Class(e,{__propertys__:function(){this.url=i.getApi("GetH5ScheduleRestaurantList"),this.param={ScheduleInfoId:100,DayIndex:1}},initialize:function($super,e){$super(e)},setScheduleInfoId:function(e){this.setParam({ScheduleInfoId:e})},getData:function(e,t){this.setParam({DayIndex:e}),this.excute(function(e){t&&t.call(this,e)})}})}),define("gsBaseView",["gsRootView","cMemberService","gsAppAgent"],function(e,t,i){return e.extend({districtId:Lizard.P("districtId")&&Lizard.P("districtId").replace(/[^0-9]/gi,""),isHybrid:Lizard.isHybrid||Lizard.isInCtripApp,localUrl:window.location.href,currentView:"",pageTag:"",from:decodeURIComponent(window.location.href),path:function(){return Lizard.isHybrid?"../webresource/js/journey/Views/Component/DatePicker.js":Lizard.webresourceBaseUrl+"js/Journey/Views/Component/DatePicker.js"}(),setHeader:function(e){e&&e.right&&this.isHybrid&&i.compareAppVersion("7.6")<1&&e.right.map(function(e){"text"==e.tagname&&(e.color="#333333",e.highlightColor="#333333")}),this._gs_super(e)},onShow:function(){this.pageTag=this.datas.pageTag,this.currentView=this,this.load(),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},this.nowDate=(new Date).format("yyyyMMdd"),this.tomorrowDate=new Date((new Date).getTime()+864e5).format("yyyyMMdd")},load:function(){if(this.pageTag)switch(this.pageTag){case"list_tag":this.listTagLoader();break;case"detail_tag":this.detailTagLoader();break;case"fixedjourney_tag":this.fixedjourneyTagLoader()}},listTagLoader:function(){this.datePicker()},detailTagLoader:function(){this.datePicker()},fixedjourneyTagLoader:function(){this.datePicker()},datePicker:function(){var e=this;require([this.path],function(t){!function(t){for(var i in t)"events"===i?_.extend(e[i],t[i]):e[i]=t[i];Backbone.View.prototype.delegateEvents.apply(e,[e.events])}(t)})},isLogin:function(e,i){t.isLogin()?i&&i():t.memberLogin({param:"from="+window.encodeURIComponent(this.localUrl),callback:function(){t.isLogin()&&e&&e()}})}})});