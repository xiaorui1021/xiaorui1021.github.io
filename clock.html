<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>桌面时钟</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E293B',
                        secondary: '#94A3B8',
                        accent: '#3B82F6',
                    },
                    fontFamily: {
                        digital: ['Segoe UI', 'Roboto', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
            .transition-smooth {
                transition: all 0.3s ease-in-out;
            }
            .menu-btn {
                opacity: 0.3;
            }
            .menu-btn:hover {
                opacity: 1;
            }
            .bg-default {
                background-image: linear-gradient(to bottom right, #1E293B, #0F172A);
            }
            .bg-custom {
                background-image: url('https://xiaorui1021.github.io/image/bgc.jpg');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
            }
        }
    </style>
</head>
<body class="bg-default text-white min-h-screen flex flex flex-col items-center justify-center overflow-hidden">
    <!-- 菜单按钮 -->
    <button id="menuBtn" class="menu-btn absolute top-4 left-4 p-2 rounded-full bg-white/10 hover:bg-white/20 transition-smooth z-10">
        <i class="fa fa-bars text-secondary text-xl"></i>
    </button>
    
    <!-- 全屏切换按钮 -->
    <button id="fullscreenBtn" class="absolute top-4 right-4 p-2 rounded-full bg-white/10 hover:bg-white/20 transition-smooth z-10">
        <i class="fa fa-expand text-secondary text-xl"></i>
    </button>
    
    <!-- 设置菜单 -->
    <div id="settingsMenu" class="hidden absolute top-16 left-4 bg-slate-800/90 backdrop-blur-sm rounded-lg p-4 shadow-xl z-20 w-64">
        <h3 class="text-lg font-medium mb-3 text-center">设置</h3>
        
        <!-- 字体颜色选择 -->
        <div class="mb-4">
            <label class="block text-sm mb-2">字体颜色</label>
            <div class="flex gap-2">
                <button class="color-option w-6 h-6 rounded-full bg-white" data-color="white"></button>
                <button class="color-option w-6 h-6 rounded-full bg-yellow-300" data-color="#FDE68A"></button>
                <button class="color-option w-6 h-6 rounded-full bg-blue-300" data-color="#93C5FD"></button>
                <button class="color-option w-6 h-6 rounded-full bg-green-300" data-color="#A7F3D0"></button>
                <button class="color-option w-6 h-6 rounded-full bg-red-300" data-color="#FECACA"></button>
                <button class="color-option w-6 h-6 rounded-full bg-purple-300" data-color="#EDE9FE"></button>
            </div>
        </div>
        
        <!-- 字体透明度调节 -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-1">
                <label class="text-sm">字体透明度</label>
                <span id="fontOpacityValue" class="text-xs text-secondary">100%</span>
            </div>
            <input type="range" id="fontOpacity" min="50" max="100" value="100" 
                   class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-accent">
        </div>
        
        <!-- 背景透明度调节 -->
        <div class="mb-4">
            <div class="flex justify-between items-center mb-1">
                <label class="text-sm">背景透明度</label>
                <span id="bgOpacityValue" class="text-xs text-secondary">100%</span>
            </div>
            <input type="range" id="bgOpacity" min="50" max="100" value="100" 
                   class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-accent">
        </div>
        
        <!-- 是否显示秒数 -->
        <div class="mb-4 flex items-center justify-between">
            <label class="text-sm">显示秒数</label>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="showSeconds" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div>
            </label>
        </div>
        
        <!-- 是否显示自定义背景 -->
        <div class="mb-4 flex items-center justify-between">
            <label class="text-sm">显示自定义背景</label>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="showCustomBackground" class="sr-only peer">
                <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"></div>
            </label>
        </div>
        
        <!-- 友情链接 -->
        <div class="pt-3 border-t border-slate-700">
            <label class="block text-sm mb-2">友情链接</label>
            <a href="https://xiaorui1021.github.io" target="_blank" class="flex items-center text-accent hover:underline text-sm transition-smooth">
                <i class="fa fa-link mr-2"></i>
                <span>xiaorui1021.github.io</span>
            </a>
        </div>
    </div>
    
    <!-- 时钟容器 -->
    <div class="container mx-auto px-4 text-center">
        <!-- 时间显示 -->
        <div id="time" class="font-digital text-[clamp(5rem,20vw,10rem)] font-bold mb-2 text-shadow leading-none">
            00:00:00
        </div>
        
        <!-- 日期显示 -->
        <div id="date" class="font-digital text-[clamp(1.2rem,5vw,2rem)] text-secondary mb-6">
            星期一, 2023年1月1日
        </div>
    </div>

    <script>
        // 从本地存储加载设置
        const loadSettings = () => {
            const savedColor = localStorage.getItem('clockTextColor') || 'white';
            const showSeconds = localStorage.getItem('showSeconds') !== 'false';
            const showCustomBackground = localStorage.getItem('showCustomBackground') === 'true';
            const fontOpacity = localStorage.getItem('fontOpacity') || 100;
            const bgOpacity = localStorage.getItem('bgOpacity') || 100;
            
            // 应用字体颜色
            document.getElementById('time').style.color = savedColor;
            document.getElementById('date').style.color = savedColor;
            
            // 应用透明度设置
            applyFontOpacity(fontOpacity);
            applyBackgroundOpacity(bgOpacity);
            
            // 设置滑块值
            document.getElementById('fontOpacity').value = fontOpacity;
            document.getElementById('bgOpacity').value = bgOpacity;
            document.getElementById('fontOpacityValue').textContent = `${fontOpacity}%`;
            document.getElementById('bgOpacityValue').textContent = `${bgOpacity}%`;
            
            // 应用其他设置
            document.getElementById('showSeconds').checked = showSeconds;
            document.getElementById('showCustomBackground').checked = showCustomBackground;
            applyBackgroundSetting(showCustomBackground);
        };
        
        // 保存设置到本地存储
        const saveSetting = (key, value) => {
            localStorage.setItem(key, value);
        };
        
        // 应用背景设置
        const applyBackgroundSetting = (useCustomBackground) => {
            const body = document.body;
            if (useCustomBackground) {
                body.classList.remove('bg-default');
                body.classList.add('bg-custom');
            } else {
                body.classList.remove('bg-custom');
                body.classList.add('bg-default');
            }
        };
        
        // 应用字体透明度
        const applyFontOpacity = (opacity) => {
            const alpha = opacity / 100;
            const timeElement = document.getElementById('time');
            const dateElement = document.getElementById('date');
            
            // 解析当前颜色
            const timeColor = window.getComputedStyle(timeElement).color;
            const dateColor = window.getComputedStyle(dateElement).color;
            
            // 应用透明度
            timeElement.style.color = adjustColorOpacity(timeColor, alpha);
            dateElement.style.color = adjustColorOpacity(dateColor, alpha);
        };
        
        // 应用背景透明度
        const applyBackgroundOpacity = (opacity) => {
            const alpha = opacity / 100;
            document.body.style.opacity = alpha;
        };
        
        // 调整颜色透明度的辅助函数
        const adjustColorOpacity = (color, alpha) => {
            // 简单处理 hex 颜色
            if (color.startsWith('#')) {
                const hex = color.replace('#', '');
                const r = parseInt(hex.substring(0, 2), 16);
                const g = parseInt(hex.substring(2, 4), 16);
                const b = parseInt(hex.substring(4, 6), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            // 处理 rgb/rgba 颜色
            const rgbMatch = color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/);
            if (rgbMatch) {
                return `rgba(${rgbMatch[1]}, ${rgbMatch[2]}, ${rgbMatch[3]}, ${alpha})`;
            }
            
            // 默认返回白色带透明度
            return `rgba(255, 255, 255, ${alpha})`;
        };
        
        // 更新时间和日期的函数
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('time');
            const showSeconds = document.getElementById('showSeconds').checked;
            
            // 格式化时间
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            let timeString = `${hours}:${minutes}`;
            if (showSeconds) {
                timeString += `:${seconds}`;
            }
            timeElement.textContent = timeString;
            
            // 格式化日期
            const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            const weekday = weekdays[now.getDay()];
            const year = now.getFullYear();
            const month = now.getMonth() + 1; // 月份从0开始，所以加1
            const day = now.getDate();
            document.getElementById('date').textContent = `${weekday}, ${year}年${month}月${day}日`;
        }
        
        // 初始化并每秒更新一次
        updateTime();
        setInterval(updateTime, 1000);
        
        // 菜单功能
        const menuBtn = document.getElementById('menuBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        
        menuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            settingsMenu.classList.toggle('hidden');
        });
        
        // 点击其他区域关闭菜单
        document.addEventListener('click', () => {
            if (!settingsMenu.classList.contains('hidden')) {
                settingsMenu.classList.add('hidden');
            }
        });
        
        // 防止点击菜单内部时关闭菜单
        settingsMenu.addEventListener('click', (e) => {
            e.stopPropagation();
        });
        
        // 字体颜色选择
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', () => {
                const color = option.getAttribute('data-color');
                const fontOpacity = document.getElementById('fontOpacity').value;
                const alpha = fontOpacity / 100;
                
                // 应用颜色和当前透明度
                document.getElementById('time').style.color = adjustColorOpacity(color, alpha);
                document.getElementById('date').style.color = adjustColorOpacity(color, alpha);
                
                saveSetting('clockTextColor', color);
            });
        });
        
        // 字体透明度调节
        document.getElementById('fontOpacity').addEventListener('input', (e) => {
            const opacity = e.target.value;
            document.getElementById('fontOpacityValue').textContent = `${opacity}%`;
            applyFontOpacity(opacity);
            saveSetting('fontOpacity', opacity);
        });
        
        // 背景透明度调节
        document.getElementById('bgOpacity').addEventListener('input', (e) => {
            const opacity = e.target.value;
            document.getElementById('bgOpacityValue').textContent = `${opacity}%`;
            applyBackgroundOpacity(opacity);
            saveSetting('bgOpacity', opacity);
        });
        
        // 显示秒数开关
        document.getElementById('showSeconds').addEventListener('change', (e) => {
            saveSetting('showSeconds', e.target.checked);
            updateTime(); // 立即更新显示
        });
        
        // 自定义背景开关
        document.getElementById('showCustomBackground').addEventListener('change', (e) => {
            const useCustomBackground = e.target.checked;
            saveSetting('showCustomBackground', useCustomBackground);
            applyBackgroundSetting(useCustomBackground);
        });
        
        // 全屏功能
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        fullscreenBtn.addEventListener('click', toggleFullScreen);
        
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`全屏请求错误: ${err.message}`);
                });
                fullscreenBtn.innerHTML = '<i class="fa fa-compress text-secondary text-xl"></i>';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.innerHTML = '<i class="fa fa-expand text-secondary text-xl"></i>';
                }
            }
        }
        
        // 监听全屏状态变化
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fullscreenBtn.innerHTML = '<i class="fa fa-compress text-secondary text-xl"></i>';
            } else {
                fullscreenBtn.innerHTML = '<i class="fa fa-expand text-secondary text-xl"></i>';
            }
        });
        
        // 防止屏幕自动关闭
        let wakeLock = null;
        
        async function requestWakeLock() {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                wakeLock.addEventListener('release', () => {
                    console.log('屏幕唤醒锁已释放');
                });
                console.log('屏幕唤醒锁已激活');
            } catch (err) {
                console.log(`无法获取唤醒锁: ${err.message}`);
            }
        }
        
        // 尝试获取唤醒锁，保持屏幕常亮
        if ('wakeLock' in navigator) {
            requestWakeLock();
            
            // 用户交互时重新获取唤醒锁
            document.addEventListener('click', () => {
                if (wakeLock === null || wakeLock.released) {
                    requestWakeLock();
                }
            });
        }
        
        // 加载保存的设置
        loadSettings();
    </script>
</body>
</html>
